# ============================================
# PostgreSQL 16 - Hardened Configuration
# Aegis NGFW Production Deployment
# ============================================

# ── Connection ──────────────────────────────
listen_addresses = '0.0.0.0'
port = 5432
max_connections = 100
superuser_reserved_connections = 3

# ── Authentication ──────────────────────────
password_encryption = 'scram-sha-256'

# ── Memory ──────────────────────────────────
shared_buffers = '256MB'
effective_cache_size = '1GB'
work_mem = '8MB'
maintenance_work_mem = '128MB'
huge_pages = 'try'

# ── WAL & Checkpoints ──────────────────────
wal_level = 'replica'
max_wal_size = '1GB'
min_wal_size = '256MB'
checkpoint_completion_target = 0.9
wal_compression = 'on'
archive_mode = 'off'

# ── Query Planner ──────────────────────────
random_page_cost = 1.1
effective_io_concurrency = 200
default_statistics_target = 100

# ── Logging ────────────────────────────────
logging_collector = 'on'
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d.log'
log_rotation_age = '1d'
log_rotation_size = '100MB'
log_min_duration_statement = 1000
log_checkpoints = 'on'
log_connections = 'on'
log_disconnections = 'on'
log_lock_waits = 'on'
log_temp_files = 0
log_line_prefix = '%t [%p-%l] %q%u@%d '
log_statement = 'ddl'

# ── Security ───────────────────────────────
ssl = off
row_security = on

# ── Autovacuum ─────────────────────────────
autovacuum = 'on'
autovacuum_max_workers = 3
autovacuum_naptime = '1min'
autovacuum_vacuum_threshold = 50
autovacuum_analyze_threshold = 50
autovacuum_vacuum_scale_factor = 0.05
autovacuum_analyze_scale_factor = 0.02

# ── Timeouts ───────────────────────────────
statement_timeout = '60s'
idle_in_transaction_session_timeout = '300s'
lock_timeout = '10s'

# ── Background Writer ─────────────────────
bgwriter_delay = '200ms'
bgwriter_lru_maxpages = 100
bgwriter_lru_multiplier = 2.0

# ── Client Defaults ───────────────────────
timezone = 'UTC'
lc_messages = 'en_US.UTF-8'
